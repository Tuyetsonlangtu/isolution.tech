{"version":3,"file":"../../server.js","sources":["webpack:///webpack/bootstrap 2d276cedaf8aa52bd6b3","webpack:///./src/common/common.js","webpack:///external \"express\"","webpack:///external \"mongoose\"","webpack:///external \"passport\"","webpack:///./src/common/config.js","webpack:///./src/common/common-code.js","webpack:///external \"crypto\"","webpack:///external \"oauth2orize\"","webpack:///./src/server/server.js","webpack:///external \"babel-polyfill\"","webpack:///./src/common/const.js","webpack:///./src/models/User.js","webpack:///./src/models/UserLogin.js","webpack:///./src/models/UserProfile.js","webpack:///./src/models/index.js","webpack:///./src/server/passport/auth.facebook.js","webpack:///./src/server/passport/auth.js","webpack:///./src/server/passport/config.js","webpack:///./src/server/passport/oauth.js","webpack:///./src/server/routes/api/index.js","webpack:///./src/server/routes/api/user.route.js","webpack:///./src/server/routes/index.js","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"passport-facebook\"","webpack:///external \"passport-http-bearer\"","webpack:///external \"path\"","webpack:///external \"randomstring\""],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/assets/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 29);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2d276cedaf8aa52bd6b3","/**\r\n * Created by hientran on 6/3/17.\r\n */\r\n\r\nimport randomString from 'randomstring';\r\nimport crypto from 'crypto';\r\nimport jwt from 'jsonwebtoken';\r\nimport config from './config';\r\nimport CONST from './const';\r\n\r\nfunction generateCode(num) {\r\n  return randomString.generate(num);\r\n}\r\n\r\nfunction createSalt(){\r\n  return generateCode(50);\r\n}\r\n\r\nfunction createId(){\r\n  return generateCode(12);\r\n}\r\n\r\nfunction passwordEncryption(pass, salt) {\r\n  const hash = crypto.createHash(\"sha256\");\r\n  let code = hash.update(pass) + salt;\r\n  return hash.update(code).digest(\"hex\");\r\n}\r\n\r\nfunction tokenGenerate(objData) {\r\n  const expiresIn = config.jwt.expiresIn;\r\n  objData.iss = config.jwt.issuer;\r\n  objData.aud = objData.email;\r\n  let token = jwt.sign(objData, config.jwt.secret, {\r\n    expiresIn: expiresIn\r\n  });\r\n  return token;\r\n}\r\n\r\nfunction tokenDecode(token, objKey) {\r\n  if(!objKey) objKey = {}\r\n  objKey.issuer = config.jwt.issuer;\r\n  console.log(\"objKey: \", objKey);\r\n  return new Promise((resolve, reject) => {\r\n    jwt.verify(token, config.jwt.secret, objKey, function (err, decoded) {\r\n      console.log(\"decoded: \", decoded);\r\n      if (err)\r\n        resolve();\r\n      else {\r\n        resolve(decoded);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction setCookie(res, key, value){\r\n  res.cookie(key, value, {\r\n    expires: config.cookie.expires,\r\n    httpOnly: config.cookie.httpOnly\r\n  });\r\n}\r\n\r\nfunction removeCookie(res, key) {\r\n  res.cookie(key, \"\", {\r\n    expires: new Date()\r\n  });\r\n}\r\n\r\nfunction setTokenCookie(res, token) {\r\n  setCookie(res, CONST.token, token);\r\n}\r\n\r\nfunction removeTokenCookie(res) {\r\n  removeCookie(res, CONST.token);\r\n}\r\n\r\n\r\nexport {\r\n  generateCode,\r\n  createSalt,\r\n  createId,\r\n  passwordEncryption,\r\n  tokenGenerate,\r\n  tokenDecode,\r\n  setTokenCookie,\r\n  removeTokenCookie\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/common/common.js\n// module id = 0\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 3\n// module chunks = 0","const port = 4000;\nmodule.exports = {\n\n  jwt: {\n    secret: process.env.JWT_SECRET || 'findmotel.isolution.tech',\n    expiresIn: 60 * 60 * 24 * 30,\n    issuer: 'findmotel.isolution.tech'\n  },\n\n  cookie: {\n    expires: new Date(Date.now() + 9999999),\n    httpOnly: false\n  },\n\n  // Node.js app\n  port: process.env.PORT || port,\n\n  // API Gateway\n  api: {\n    // API URL to be used in the client-side code\n    clientUrl: process.env.API_CLIENT_URL || '',\n    // API URL to be used in the server-side code\n    serverUrl: process.env.API_SERVER_URL || `http://localhost:${process.env.PORT || port}`,\n  },\n\n  analytics: {\n    googleTrackingId: process.env.GOOGLE_TRACKING_ID, // UA-XXXXX-X\n  },\n\n  database: {\n    mongoose: {\n      databaseURI : \"mongodb://localhost:27017/ISolution-FindMotel\",\n      logging: false\n    }\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/common/config.js\n// module id = 4\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/9/2017.\r\n */\r\n\r\nconst systems = {\r\n  unauthorized: {\r\n    code: 401,\r\n    msg: \"Unauthorized!\"\r\n  },\r\n  forbidden: {\r\n    code: 403,\r\n    msg: \"Forbidden!\"\r\n  },\r\n  notFound: {\r\n    code: 404,\r\n    msg: \"Not Found!\"\r\n  },\r\n  invalidToken: {\r\n    code: 600,\r\n    msg: 'Invalid Token!'\r\n  },\r\n  systemError: {\r\n    code: 500,\r\n    msg: \"System Error!\"\r\n  }\r\n}\r\n\r\nexport { systems }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/common/common-code.js\n// module id = 5\n// module chunks = 0","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"oauth2orize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"oauth2orize\"\n// module id = 7\n// module chunks = 0","/**\r\n * Created by hien.tran on 5/29/2017.\r\n */\r\n\r\n\"use strict\";\r\nimport path from 'path';\r\nimport express from 'express';\r\nimport cookieParser from 'cookie-parser';\r\nimport bodyParser from 'body-parser';\r\nimport config from '../common/config';\r\nimport passport from 'passport';\r\nimport publicApi from './routes';\r\nimport privateApi from './routes/api';\r\nimport validateToken from './passport/auth';\r\nimport oauth from './passport/oauth';\r\nimport crypto from 'crypto';\r\nimport {systems} from '../common/common-code';\r\n\r\nlet app = express();\r\n\r\n//random secret key when start server node\r\n//config.jwt.secret = crypto.randomBytes(48).toString('hex');\r\napp.use(cookieParser());\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(bodyParser.json());\r\n\r\napp.use(express.static(path.join(__dirname, 'public')));\r\napp.all('/*', function(req, res, next) {\r\n  // CORS headers\r\n  res.header(\"Access-Control-Allow-Origin\", \"*\"); // restrict it to the required domain\r\n  res.header('Access-Control-Allow-Methods', 'GET,PUT,POST,DELETE,OPTIONS');\r\n  // Set custom headers for CORS\r\n  res.header('Access-Control-Allow-Headers', 'Content-type,Accept,X-Access-Token,X-Key');\r\n  if (req.method == 'OPTIONS') {\r\n    res.status(200).end();\r\n  } else {\r\n    next();\r\n  }\r\n});\r\n\r\napp.use(\"/\", publicApi);\r\n\r\napp.use(passport.initialize());\r\napp.post('/oauth/token', oauth.token);\r\napp.all('/api/*', validateToken);\r\napp.use(\"/api\", privateApi);\r\n\r\napp.use(function (err, req, res, next) {\r\n  switch(err.code){\r\n    case 401:\r\n      res.status(401).json(systems.unauthorized);\r\n      break;\r\n    case 403:\r\n      res.status(403).json(systems.forbidden);\r\n      break;\r\n    default:\r\n      res.status(err.status || 500).json(systems.systemError);\r\n      break;\r\n  }\r\n});\r\n\r\napp.use(function(req, res, next) {\r\n  res.status(404).json(systems.notFound);\r\n});\r\n\r\napp.listen(config.port, () => {\r\n  console.info(`The server is running at http://localhost:${config.port}/`);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/server.js\n// module id = 8\n// module chunks = 0","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 9\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/12/2017.\r\n */\r\n\r\nconst CONST = {\r\n  token: 'token'\r\n}\r\n\r\nexport default CONST;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/common/const.js\n// module id = 10\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\"use strict\";\r\nimport mongoose from 'mongoose';\r\nimport { createSalt, createId } from '../common/common';\r\nlet Schema = mongoose.Schema;\r\n\r\nconst User = new Schema({\r\n  _id: {\r\n    type: String,\r\n    default: createId,\r\n    index: true,\r\n    unique: true\r\n  },\r\n\r\n  username:{\r\n    type: String,\r\n    unique: true,\r\n  },\r\n\r\n  password:{\r\n    type: String,\r\n    unique: true,\r\n  },\r\n\r\n  salt: {\r\n    type: String,\r\n    default: createSalt\r\n  },\r\n\r\n  email: {\r\n    type: String,\r\n    unique: true,\r\n    sparse: true,\r\n    dropDups: true\r\n  },\r\n\r\n  isAdmin: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n\r\n  accessToken: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n\r\n  expirationDate: {\r\n    type: Date,\r\n    default: Date.now\r\n  },\r\n\r\n  isEnabled: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n\r\n  logins: [{\r\n    type: String,\r\n    ref: 'UserLogin'\r\n  }],\r\n\r\n  profile: {\r\n    type: String,\r\n    ref: 'UserProfile'\r\n  },\r\n\r\n  createdAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  },\r\n\r\n  updatedAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  }\r\n});\r\n\r\nexport default {\r\n  name: 'User',\r\n  schema: User\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/models/User.js\n// module id = 11\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\"use strict\";\r\nimport mongoose from 'mongoose';\r\nimport { createId } from '../common/common';\r\n\r\nlet Schema = mongoose.Schema;\r\n\r\nconst UserLogin = new Schema({\r\n  _id: {\r\n    type: String,\r\n    default: createId,\r\n    index: true,\r\n    unique: true\r\n  },\r\n\r\n  name:{\r\n    type: String,\r\n    unique: true,\r\n  },\r\n\r\n  key:{\r\n    type: String,\r\n    unique: true,\r\n  },\r\n\r\n  token:{\r\n    type: String,\r\n    unique: true,\r\n  },\r\n\r\n  createdAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  },\r\n\r\n  updatedAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  }\r\n});\r\n\r\nexport default {\r\n  name: 'UserLogin',\r\n  schema: UserLogin\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/models/UserLogin.js\n// module id = 12\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\"use strict\";\r\nimport mongoose from 'mongoose';\r\nimport { createId } from '../common/common';\r\n\r\nlet Schema = mongoose.Schema;\r\nconst UserProfile = new Schema({\r\n  _id: {\r\n    type: String,\r\n    default: createId,\r\n    index: true,\r\n    unique: true\r\n  },\r\n\r\n  displayName: {\r\n    type: String,\r\n    default: \"\"\r\n  },\r\n\r\n  picture: {\r\n    type: String,\r\n    default: \"\"\r\n  },\r\n\r\n  gender: {\r\n    type: String,\r\n    default: \"\"\r\n  },\r\n\r\n  location: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n\r\n  phone: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n\r\n  createdAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  },\r\n\r\n  updatedAt: {\r\n    type: Date,\r\n    default: Date.now\r\n  }\r\n});\r\n\r\nexport default {\r\n  name: 'UserProfile',\r\n  schema: UserProfile\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/models/UserProfile.js\n// module id = 13\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\"use strict\";\r\nimport mongoose from 'mongoose';\r\nimport config from '../common/config';\r\nimport user from './User';\r\nimport userLogin from './UserLogin';\r\nimport userProfile from './UserProfile';\r\n\r\n//Config mongodb\r\nlet conn = mongoose.createConnection(config.database.mongoose.databaseURI)\r\nlet Schema = mongoose.Schema;\r\nmongoose.Promise = Promise;\r\nmongoose.set('debug', config.database.mongoose.logging);\r\n\r\nconst User = conn.model(user.name, user.schema);\r\nconst UserProfile = conn.model(userProfile.name, userProfile.schema);\r\nconst UserLogin = conn.model(userLogin.name, userLogin.schema);\r\nexport { UserLogin, User , UserProfile}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/models/index.js\n// module id = 14\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\nimport passport from 'passport';\r\nimport { Strategy as FacebookStrategy } from 'passport-facebook';\r\nimport config from './config';\r\nimport { UserLogin , User, UserProfile} from '../../models';\r\nimport { passwordEncryption } from '../../common/common';\r\n\r\npassport.use(new FacebookStrategy({\r\n  clientID: config.auth.facebook.clientID,\r\n  clientSecret: config.auth.facebook.clientSecret,\r\n  callbackURL: config.auth.facebook.callbackURL,\r\n  profileFields: ['displayName', 'name', 'email', 'link', 'locale', 'timezone'],\r\n  passReqToCallback: true,\r\n}, (req, accessToken, refreshToken, profile, next) => {\r\n  const loginName = 'facebook';\r\n  const claimType = 'urn:facebook:access_token';\r\n  const fooBar = async () => {\r\n    if (req.user) {\r\n      next(null, {id: '123', email: 'Hien Tran',});\r\n    } else {\r\n      let user = await User\r\n        .findOne({\r\n          'email': profile._json.email\r\n        })\r\n        .populate('profile')\r\n        .populate({\r\n          path: 'logins',\r\n          match: {'name': loginName, 'key': profile.id}\r\n        });\r\n\r\n      if (user) {\r\n        let userLogin = user.logins.length == 0 ? new UserLogin() : user.logins[0];\r\n        userLogin.name = loginName;\r\n        userLogin.key = profile.id;\r\n        userLogin.token = accessToken;\r\n        userLogin = await userLogin.save();\r\n\r\n        let userProfile = user.profile ? user.profile : new UserProfile();\r\n        userProfile.displayName = profile.displayName;\r\n        userProfile.picture = `https://graph.facebook.com/${profile.id}/picture?type=large`;\r\n        userProfile.gender = profile._json.gender;\r\n        userProfile.location = profile.location;\r\n        userProfile = await userProfile.save();\r\n\r\n        if(user.logins.length == 0)\r\n          user.logins.push(userLogin);\r\n\r\n        if(!user.profile)\r\n          user.profile = userProfile;\r\n\r\n        user = await user.save();\r\n        next(null, user);\r\n\r\n      } else {\r\n        user = new User();\r\n        //create login with facebook\r\n        let userLogin = new UserLogin({\r\n          name: loginName,\r\n          key: profile.id,\r\n          token: accessToken\r\n        });\r\n        userLogin = await userLogin.save();\r\n\r\n        //create user profile\r\n        let userProfile = await new UserProfile({\r\n          displayName: profile.displayName,\r\n          picture: `https://graph.facebook.com/${profile.id}/picture?type=large`,\r\n          gender: profile._json.gender,\r\n          location: profile.location\r\n        });\r\n        userProfile = await userProfile.save();\r\n\r\n        //main account\r\n        user.username = \"admin\";\r\n        user.password = passwordEncryption(\"123456\", user.salt);\r\n        user.email = profile._json.email;\r\n        user.logins.push(userLogin);\r\n        user.profile = userProfile;\r\n        user = await user.save();\r\n        next(null, user);\r\n      }\r\n    }\r\n  };\r\n  fooBar().catch(next);\r\n}));\r\n\r\nexport default passport;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/passport/auth.facebook.js\n// module id = 15\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\"use strict\";\r\nimport passportHttpBearer from 'passport-http-bearer';\r\nimport oauth2orize from 'oauth2orize';\r\nimport passport from 'passport';\r\nimport {systems} from '../../common/common-code';\r\nimport {tokenDecode} from '../../common/common';\r\n\r\nlet BearerStrategy = passportHttpBearer.Strategy;\r\nlet TokenError = oauth2orize.TokenError;\r\n\r\n\r\npassport.use(\"bearer\", new BearerStrategy(\r\n  function (accessToken, next) {\r\n    let promise = tokenDecode(accessToken);\r\n    promise.then(result => {\r\n      if(result)\r\n        return next(null, result);\r\n      else\r\n        return next(new Error('token error'));\r\n    })\r\n  }\r\n));\r\n\r\nconst validateToken = function(req, res, next) {\r\n  passport.authenticate('bearer', {session: false}, function (err, user, info) {\r\n    if (err || !user)\r\n      return res.json(systems.invalidToken)\r\n    else {\r\n      return next();\r\n    }\r\n  })(req, res, next)\r\n}\r\n\r\nexport default validateToken;\r\n\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/passport/auth.js\n// module id = 16\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\r\nmodule.exports = {\r\n  // Authentication\r\n  auth: {\r\n    facebook: {\r\n      clientID: process.env.FACEBOOK_APP_ID || '2006619856232997',\r\n      clientSecret: process.env.FACEBOOK_APP_SECRET || '2466ea45b5f5d3d1b2227758c08f0922',\r\n      callbackURL: '/auth/facebook/callback'\r\n    },\r\n\r\n    google: {\r\n      id: process.env.GOOGLE_CLIENT_ID || '251410730550-ahcg0ou5mgfhl8hlui1urru7jn5s12km.apps.googleusercontent.com',\r\n      secret: process.env.GOOGLE_CLIENT_SECRET || 'Y8yR9yZAhm9jQ8FKAL8QIEcd',\r\n    },\r\n\r\n    twitter: {\r\n      key: process.env.TWITTER_CONSUMER_KEY || 'Ie20AZvLJI2lQD5Dsgxgjauns',\r\n      secret: process.env.TWITTER_CONSUMER_SECRET || 'KTZ6cxoKnEakQCeSpZlaUCJWGAlTEBJj0y2EMkUBujA7zWSvaQ',\r\n    },\r\n  },\r\n};\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/passport/config.js\n// module id = 17\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\"use strict\";\r\nimport oauth2orize from 'oauth2orize';\r\nimport passport from 'passport';\r\n\r\nlet server = oauth2orize.createServer();\r\n\r\n\r\nexport default {\r\n  token: [server.token(), server.errorHandler()]\r\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/passport/oauth.js\n// module id = 18\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\"use strict\";\r\nimport express from 'express';\r\nimport userRoute from './user.route';\r\nlet router = express.Router();\r\n\r\nrouter.use(\"/user\", userRoute);\r\nexport default router;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/routes/api/index.js\n// module id = 19\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\"use strict\";\r\nimport express from 'express';\r\nlet router = express.Router();\r\n\r\nrouter.get('/', (req, res) => {\r\n  //res.clearCookie('id_token');\r\n  res.json({rs: \"ok\"});\r\n});\r\n\r\nexport default router;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/routes/api/user.route.js\n// module id = 20\n// module chunks = 0","/**\r\n * Created by hien.tran on 6/2/2017.\r\n */\r\n\r\n\"use strict\";\r\n\r\nimport express from 'express';\r\nimport fbPassport from '../passport/auth.facebook';\r\nimport {tokenGenerate, setTokenCookie, removeTokenCookie} from '../../common/common';\r\n\r\nlet router = express.Router();\r\n\r\nrouter.get('/status', (req, res) => {\r\n  var cookies = req.cookies;\r\n  console.log(\"cookie: \", cookies.token);\r\n  res.json({status: \"server runing\"});\r\n});\r\n\r\nrouter.post('/user', (req, res) => {\r\n  res.json({status: \"create user\"});\r\n});\r\n\r\nrouter.get('/auth/facebook',\r\n  fbPassport.authenticate('facebook', { scope: ['email', 'user_location'], session: false })\r\n);\r\n\r\nrouter.get('/auth/facebook/callback',\r\n  fbPassport.authenticate('facebook', {session: false }),\r\n  (req, res) => {\r\n    if (req.user) {\r\n      let user = {\r\n        id: req.user._id,\r\n        username: req.user.username,\r\n        email: req.user.email\r\n      }\r\n      let token = tokenGenerate(user);\r\n      user['profile'] = req.user.profile;\r\n      setTokenCookie(res, token);\r\n      res.json({\r\n        token: token,\r\n        user: user\r\n      });\r\n    }\r\n    else {\r\n      removeTokenCookie(res);\r\n      res.json({\r\n        token: \"\",\r\n        user: null\r\n      });\r\n    }\r\n});\r\n\r\nexport default router;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/routes/index.js\n// module id = 21\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"passport-facebook\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-facebook\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"passport-http-bearer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-http-bearer\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"randomstring\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"randomstring\"\n// module id = 28\n// module chunks = 0"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;A;;;;;AChEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC3EA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACnCA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC1BA;;;;;;ACAA;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACnEA;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACRA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACnFA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC/CA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACxDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACnBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACzFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACxBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACbA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACVA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACpDA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;;;;;;A","sourceRoot":""}